<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Download notes, syllabus, question papers and fix questions for VTU subjects.">
  <title>Subject Resources - Braintube</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="../styles/index.css">
  <link rel="icon" type="image/svg+xml"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' style='stop-color:%238b5cf6'/><stop offset='100%25' style='stop-color:%2306b6d4'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23g)'/><text x='50' y='65' font-size='50' fill='white' text-anchor='middle' font-family='Arial' font-weight='bold'>B</text></svg>">
  <!-- Razorpay Checkout Script -->
  <link rel="preconnect" href="https://checkout.razorpay.com">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>

<body>
  <header class="header" id="header">
    <div class="header-inner">
      <a href="../index.html" class="logo">
        <div class="logo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white"
            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
            <path d="M6 12v5c3 3 9 3 12 0v-5" />
          </svg>
        </div>
        <span>Brain<span class="text-gradient">tube</span></span>
      </a>
      <nav class="nav">
        <a href="../index.html" class="nav-link">Home</a>
        <a href="branches.html" class="nav-link active">Branches</a>
        <a href="resources.html" class="nav-link">Resources</a>
        <a href="pricing.html" class="nav-link">Premium</a>
        <a href="contact.html" class="nav-link">Contact</a>
      </nav>
      <div class="header-actions">
        <a href="login.html" class="btn btn-secondary hide-mobile">Login</a>
        <button class="menu-toggle" id="menuToggle"><span></span><span></span><span></span></button>
      </div>
    </div>
  </header>

  <nav class="mobile-nav" id="mobileNav">
    <a href="../index.html" class="mobile-nav-link">Home</a>
    <a href="branches.html" class="mobile-nav-link">Branches</a>
    <a href="contact.html" class="mobile-nav-link">Contact</a>
  </nav>

  <main>
    <section class="page-hero">
      <div class="container">
        <nav class="breadcrumb">
          <a href="../index.html">Home</a>
          <span class="breadcrumb-separator">/</span>
          <a href="branches.html">Branches</a>
          <span class="breadcrumb-separator">/</span>
          <a href="#" id="branchLink">CSE</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current" id="subjectCode">BCS304</span>
        </nav>
        <span class="subject-code" id="subjectCodeBadge"
          style="font-size: var(--text-base); padding: var(--space-2) var(--space-4);">BCS304</span>
        <h1 id="subjectName" style="margin-top: var(--space-4);">Data Structures</h1>
        <div class="flex gap-6" style="margin-top: var(--space-4); color: var(--text-secondary); flex-wrap: wrap;">
          <span style="display: flex; align-items: center; gap: 4px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
            </svg>
            <span id="credits">4</span> Credits
          </span>
          <span style="display: flex; align-items: center; gap: 4px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="18" height="18" x="3" y="4" rx="2" ry="2" />
              <line x1="16" x2="16" y1="2" y2="6" />
              <line x1="8" x2="8" y1="2" y2="6" />
              <line x1="3" x2="21" y1="10" y2="10" />
            </svg>
            Semester <span id="semNum">3</span>
          </span>
          <span style="display: flex; align-items: center; gap: 4px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 10v6M2 10l10-5 10 5-10 5z" />
              <path d="M6 12v5c3 3 9 3 12 0v-5" />
            </svg>
            <span id="branchName">CSE</span>
          </span>
          <span style="display: flex; align-items: center; gap: 4px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
            </svg>
            2022 Scheme
          </span>
        </div>
      </div>
    </section>

    <section class="section" style="padding-top: var(--space-8);">
      <div class="container">
        <div class="tabs" id="resourceTabs">
          <button class="tab active" data-tab="notes">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20" />
            </svg>
            Notes
          </button>
          <button class="tab" data-tab="syllabus">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
              <rect width="8" height="4" x="8" y="2" rx="1" ry="1" />
            </svg>
            Syllabus
          </button>
          <button class="tab" data-tab="papers">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
              <polyline points="14 2 14 8 20 8" />
            </svg>
            Question Papers
          </button>
          <button class="tab" data-tab="lab">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M10 2v8.5L7.5 14h9l-2.5-3.5V2" />
              <path d="M8.5 2h7" />
              <path d="M14 22H8a2 2 0 0 1-2-2v-4h12v4a2 2 0 0 1-2 2Z" />
            </svg>
            Lab Manual
          </button>
          <button class="tab" data-tab="fix">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
              <path d="m9 12 2 2 4-4" />
            </svg>
            Fix Questions
          </button>
        </div>

        <div id="tabContent">
          <!-- Notes Tab -->
          <div class="tab-panel active" id="notes-panel"></div>
          <!-- Syllabus Tab -->
          <div class="tab-panel" id="syllabus-panel" style="display: none;"></div>
          <!-- Question Papers Tab -->
          <div class="tab-panel" id="papers-panel" style="display: none;"></div>
          <!-- Lab Manual Tab -->
          <div class="tab-panel" id="lab-panel" style="display: none;"></div>
          <!-- Fix Questions Tab -->
          <div class="tab-panel" id="fix-panel" style="display: none;"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-bottom" style="border-top: none; padding-top: 0;">
        <p class="footer-copyright">Â© 2026 Braintube. Made with dedication for VTU Students across Karnataka.</p>
      </div>
    </div>
  </footer>

  <script src="../scripts/data.js"></script>
  <script src="../scripts/config.js"></script>
  <script src="../scripts/main.js"></script>
  <script src="../scripts/notes-extended.js"></script>
  <script src="../scripts/syllabus.js"></script>
  <script src="../scripts/syllabus-extended.js"></script>
  <script src="../scripts/syllabus-complete.js"></script>
  <script>
    // Syllabus data for all subjects
    const syllabusData = {
      // CSE Subjects
      'BCS301': {
        name: 'Mathematics for Computer Science',
        modules: [
          { num: 1, title: 'Linear Algebra', hours: 10, topics: 'Matrices, Eigenvalues, Eigenvectors, Diagonalization, LU Decomposition' },
          { num: 2, title: 'Calculus', hours: 8, topics: 'Partial Derivatives, Multiple Integrals, Vector Calculus' },
          { num: 3, title: 'Probability', hours: 8, topics: 'Random Variables, Distributions, Bayes Theorem' },
          { num: 4, title: 'Statistics', hours: 8, topics: 'Mean, Variance, Regression, Correlation' },
          { num: 5, title: 'Graph Theory', hours: 8, topics: 'Graphs, Trees, Shortest Paths, Network Flow' }
        ],
        objectives: ['Apply linear algebra in computing', 'Solve probability problems', 'Analyze statistical data', 'Apply graph theory concepts']
      },
      'BCS302': {
        name: 'Digital Design & Computer Organization',
        modules: [
          { num: 1, title: 'Digital Logic', hours: 10, topics: 'Boolean Algebra, Logic Gates, Combinational Circuits' },
          { num: 2, title: 'Sequential Circuits', hours: 8, topics: 'Flip-Flops, Counters, Registers, FSM' },
          { num: 3, title: 'Memory Organization', hours: 8, topics: 'RAM, ROM, Cache Memory, Virtual Memory' },
          { num: 4, title: 'CPU Organization', hours: 10, topics: 'Instruction Set, ALU, Control Unit, Pipelining' },
          { num: 5, title: 'I/O Organization', hours: 6, topics: 'I/O Interface, DMA, Interrupts' }
        ],
        objectives: ['Design combinational circuits', 'Design sequential circuits', 'Understand CPU architecture', 'Analyze memory hierarchy']
      },
      'BCS303': {
        name: 'Operating Systems',
        modules: [
          { num: 1, title: 'OS Introduction', hours: 8, topics: 'OS Structure, System Calls, Process Concept' },
          { num: 2, title: 'Process Management', hours: 10, topics: 'Scheduling, Synchronization, Deadlocks' },
          { num: 3, title: 'Memory Management', hours: 10, topics: 'Paging, Segmentation, Virtual Memory' },
          { num: 4, title: 'File Systems', hours: 8, topics: 'File Organization, Directory, Allocation Methods' },
          { num: 5, title: 'I/O & Security', hours: 6, topics: 'Disk Scheduling, Protection, Security' }
        ],
        objectives: ['Understand OS concepts', 'Analyze process scheduling', 'Implement memory management', 'Design file systems']
      },
      'BCS304': {
        name: 'Data Structures and Applications',
        modules: [
          { num: 1, title: 'Introduction', hours: 8, topics: 'Arrays, Structures, Pointers, Dynamic Memory' },
          { num: 2, title: 'Stacks & Queues', hours: 10, topics: 'Stack ADT, Queue ADT, Applications, Expression Evaluation' },
          { num: 3, title: 'Linked Lists', hours: 8, topics: 'Singly, Doubly, Circular Lists, Applications' },
          { num: 4, title: 'Trees', hours: 10, topics: 'Binary Trees, BST, AVL Trees, B-Trees, Heaps' },
          { num: 5, title: 'Graphs', hours: 10, topics: 'Representations, BFS, DFS, Shortest Path, MST' }
        ],
        objectives: ['Implement linear data structures', 'Apply tree structures', 'Implement graph algorithms', 'Analyze complexity']
      },
      'BCS305A': {
        name: 'Object Oriented Programming with Java',
        modules: [
          { num: 1, title: 'Java Basics', hours: 8, topics: 'JVM, Data Types, Operators, Control Flow' },
          { num: 2, title: 'Classes & Objects', hours: 10, topics: 'Classes, Constructors, Methods, Arrays' },
          { num: 3, title: 'Inheritance', hours: 8, topics: 'Inheritance, Polymorphism, Abstract Classes' },
          { num: 4, title: 'Packages & Interfaces', hours: 8, topics: 'Packages, Interfaces, Exception Handling' },
          { num: 5, title: 'Multithreading', hours: 8, topics: 'Threads, Synchronization, I/O Streams' }
        ],
        objectives: ['Write Java programs', 'Apply OOP concepts', 'Handle exceptions', 'Implement multithreading']
      },
      'BCS401': {
        name: 'Analysis & Design of Algorithms',
        modules: [
          { num: 1, title: 'Algorithm Analysis', hours: 8, topics: 'Asymptotic Notations, Recurrence Relations' },
          { num: 2, title: 'Divide & Conquer', hours: 10, topics: 'Merge Sort, Quick Sort, Binary Search' },
          { num: 3, title: 'Greedy Method', hours: 8, topics: 'Knapsack, Job Sequencing, MST, Shortest Path' },
          { num: 4, title: 'Dynamic Programming', hours: 10, topics: 'MCM, LCS, 0/1 Knapsack, Floyd-Warshall' },
          { num: 5, title: 'Backtracking & B&B', hours: 8, topics: 'N-Queens, Graph Coloring, TSP' }
        ],
        objectives: ['Analyze algorithm complexity', 'Apply design techniques', 'Solve optimization problems']
      },
      'BCS403': {
        name: 'Database Management Systems',
        modules: [
          { num: 1, title: 'Introduction', hours: 8, topics: 'DBMS Architecture, Data Models, ER Model' },
          { num: 2, title: 'Relational Model', hours: 10, topics: 'Relational Algebra, SQL, Constraints' },
          { num: 3, title: 'Database Design', hours: 10, topics: 'Functional Dependencies, Normalization' },
          { num: 4, title: 'Transactions', hours: 8, topics: 'ACID, Concurrency Control, Recovery' },
          { num: 5, title: 'Storage & Indexing', hours: 6, topics: 'File Organization, B+ Trees, Hashing' }
        ],
        objectives: ['Design databases', 'Write SQL queries', 'Apply normalization', 'Manage transactions']
      },
      'BCS501': {
        name: 'Software Engineering & Project Management',
        modules: [
          { num: 1, title: 'SE Introduction', hours: 8, topics: 'Software Process, Agile, Requirements' },
          { num: 2, title: 'Design', hours: 10, topics: 'System Design, UML, Design Patterns' },
          { num: 3, title: 'Testing', hours: 8, topics: 'Testing Strategies, Test Case Design' },
          { num: 4, title: 'Project Management', hours: 10, topics: 'Planning, Scheduling, Risk Management' },
          { num: 5, title: 'Quality & Metrics', hours: 6, topics: 'Software Quality, Metrics, SCM' }
        ],
        objectives: ['Apply SE principles', 'Manage software projects', 'Ensure software quality']
      },
      'BCS502': {
        name: 'Computer Networks',
        modules: [
          { num: 1, title: 'Introduction', hours: 8, topics: 'Network Models, OSI, TCP/IP' },
          { num: 2, title: 'Data Link Layer', hours: 10, topics: 'Framing, Error Control, MAC Protocols' },
          { num: 3, title: 'Network Layer', hours: 10, topics: 'IP Addressing, Routing Algorithms' },
          { num: 4, title: 'Transport Layer', hours: 8, topics: 'TCP, UDP, Congestion Control' },
          { num: 5, title: 'Application Layer', hours: 6, topics: 'HTTP, DNS, Email, Security' }
        ],
        objectives: ['Understand network layers', 'Analyze protocols', 'Design networks']
      },
      'BCS503': {
        name: 'Theory of Computation',
        modules: [
          { num: 1, title: 'Automata', hours: 10, topics: 'DFA, NFA, Regular Expressions' },
          { num: 2, title: 'Context-Free', hours: 10, topics: 'CFG, PDA, Parsing' },
          { num: 3, title: 'Turing Machines', hours: 8, topics: 'TM Design, Variants, Computability' },
          { num: 4, title: 'Decidability', hours: 8, topics: 'Decidable & Undecidable Problems' },
          { num: 5, title: 'Complexity', hours: 6, topics: 'P, NP, NP-Complete, Reductions' }
        ],
        objectives: ['Design automata', 'Analyze computability', 'Understand complexity classes']
      },
      'BCS603': {
        name: 'Machine Learning',
        modules: [
          { num: 1, title: 'Introduction', hours: 8, topics: 'ML Types, Feature Engineering, Evaluation' },
          { num: 2, title: 'Supervised Learning', hours: 12, topics: 'Linear Regression, Logistic Regression, SVM, Decision Trees' },
          { num: 3, title: 'Ensemble Methods', hours: 8, topics: 'Random Forest, Bagging, Boosting, XGBoost' },
          { num: 4, title: 'Unsupervised Learning', hours: 8, topics: 'K-Means, Hierarchical, DBSCAN, PCA' },
          { num: 5, title: 'Neural Networks', hours: 8, topics: 'Perceptron, MLP, Backpropagation, Deep Learning Intro' }
        ],
        objectives: ['Apply ML algorithms', 'Evaluate models', 'Solve classification & regression problems']
      },
      'BCS701': {
        name: 'Internet of Things',
        code: 'BCS701',
        credits: 4,
        isPremium: true,
        description: 'This course covers the fundamentals of Internet of Things including IoT architecture, enabling technologies, M2M communication, IoT platforms, and physical devices like Raspberry Pi.',
        modules: [
          { num: 1, title: 'Introduction to Internet of Things', hours: 8, topics: 'Introduction to IoT, Physical Design of IoT, Logical Design of IoT, IoT Enabling Technologies, IoT Levels and Deployment Templates' },
          { num: 2, title: 'IoT and M2M', hours: 8, topics: 'M2M vs IoT, SDN and NFV for IoT, IoT Systems Management with NETCONF-YANG, SNMP, Network Operator Requirements' },
          { num: 3, title: 'IoT Platforms Design Methodology', hours: 10, topics: 'IoT Design Methodology, Case Study: Weather Monitoring, Python for IoT, Data Types, Control Flow, Functions, Modules, Packages, File Handling, Classes' },
          { num: 4, title: 'IoT Physical Devices', hours: 8, topics: 'Raspberry Pi Board, Linux on Raspberry Pi, Raspberry Pi Interfaces, Programming Raspberry Pi with Python, IoT Physical Servers' },
          { num: 5, title: 'IoT Case Studies', hours: 8, topics: 'Home Automation, Smart Cities, Environment Monitoring, Agriculture IoT, Healthcare IoT Applications' }
        ],
        objectives: [
          'Understand the fundamentals of Internet of Things',
          'Learn IoT enabling technologies and communication protocols',
          'Design IoT systems using appropriate methodology',
          'Program IoT devices using Python and Raspberry Pi',
          'Apply IoT concepts to real-world case studies'
        ],
        outcomes: [
          'CO1: Explain the concepts and architecture of IoT systems',
          'CO2: Differentiate between IoT and M2M communication',
          'CO3: Design IoT systems using appropriate methodology',
          'CO4: Program Raspberry Pi for IoT applications using Python',
          'CO5: Apply IoT concepts to develop real-world applications'
        ],
        textbooks: [
          'Internet of Things: A Hands-On Approach by Arshdeep Bahga and Vijay Madisetti, Universities Press',
          'Getting Started with Raspberry Pi by Matt Richardson, O\'Reilly Media'
        ],
        references: [
          'Designing the Internet of Things by Adrian McEwen and Hakim Cassimally, Wiley',
          'Building the Internet of Things by Maciej Kranz, Wiley'
        ],
        fixQuestions: {
          module1: [
            'Explain the physical design of IoT with a neat diagram. Discuss IoT Protocols.',
            'Describe the logical design of IoT. Explain functional blocks and communication models.',
            'What are IoT enabling technologies? Explain Wireless Sensor Networks and Cloud Computing.',
            'Explain IoT levels 1 to 6 with deployment templates and examples.'
          ],
          module2: [
            'Differentiate between IoT and M2M. Explain with suitable examples.',
            'Explain SDN (Software Defined Networking) and NFV for IoT applications.',
            'Describe NETCONF-YANG for IoT systems management with architecture.',
            'What is SNMP? Explain its role in network management for IoT.'
          ],
          module3: [
            'Explain the step-by-step IoT design methodology with a block diagram.',
            'Design an IoT system for weather monitoring. Draw the block diagram.',
            'Write a Python program to interface temperature sensor with Raspberry Pi.',
            'Explain Python packages used for IoT: request, JSON, urllib, smtplib.'
          ],
          module4: [
            'Explain the Raspberry Pi board architecture with a neat diagram.',
            'How to set up Linux on Raspberry Pi? Explain the boot process.',
            'Describe GPIO programming on Raspberry Pi using Python with example.',
            'Write a Python program to control LED blinking using Raspberry Pi GPIO.'
          ],
          module5: [
            'Design an IoT-based Home Automation system with block diagram.',
            'Explain Smart City applications of IoT with architecture diagram.',
            'Design an IoT-based environment monitoring system for pollution detection.',
            'Describe IoT applications in Agriculture. Draw the system architecture.'
          ]
        }
      },
      'BCS702': {
        name: 'Parallel Computing',
        code: 'BCS702',
        credits: 3,
        isPremium: true,
        modules: [
          { num: 1, title: 'Introduction to Parallel Computing', hours: 8, topics: 'Parallel Computing Basics, Flynn Classification, Parallel Architectures' },
          { num: 2, title: 'Parallel Algorithm Design', hours: 8, topics: 'PRAM Model, Parallel Algorithm Design Techniques' },
          { num: 3, title: 'Programming Shared Memory', hours: 8, topics: 'OpenMP, Thread Programming, Synchronization' },
          { num: 4, title: 'Programming Distributed Memory', hours: 8, topics: 'MPI, Message Passing, Point-to-Point Communication' },
          { num: 5, title: 'GPU Computing', hours: 8, topics: 'CUDA Programming, GPU Architecture, Parallel Patterns' }
        ],
        fixQuestions: {
          module1: [
            'Explain Flynn\'s classification of computer architectures with examples.',
            'Compare SIMD and MIMD architectures with diagrams.',
            'What are the challenges in parallel computing? Explain Amdahl\'s Law.',
            'Describe different parallel computer memory architectures.'
          ],
          module2: [
            'Explain the PRAM model with its variants (EREW, CREW, CRCW).',
            'Describe decomposition techniques in parallel algorithm design.',
            'What is task dependency graph? Explain with an example.',
            'Explain the concept of speedup and efficiency in parallel computing.'
          ],
          module3: [
            'Explain OpenMP architecture and its directives with examples.',
            'Write an OpenMP program for parallel matrix multiplication.',
            'Describe synchronization constructs in OpenMP.',
            'What are critical sections? Explain with OpenMP example.'
          ],
          module4: [
            'Explain MPI point-to-point communication with examples.',
            'Describe collective communication operations in MPI.',
            'Write an MPI program for parallel sum calculation.',
            'Compare blocking and non-blocking communication in MPI.'
          ],
          module5: [
            'Explain CUDA programming model and GPU architecture.',
            'Write a CUDA kernel for vector addition.',
            'Describe memory hierarchy in GPU computing.',
            'What are warps and thread blocks in CUDA? Explain.'
          ]
        }
      },
      'BEC701': {
        name: 'Microwave Engineering and Antenna Theory',
        code: 'BEC701',
        credits: 4,
        isPremium: true,
        modules: [
          { num: 1, title: 'Microwave Transmission Lines', hours: 8, topics: 'Transmission Lines, Smith Chart, Impedance Matching' },
          { num: 2, title: 'Microwave Components', hours: 8, topics: 'Waveguides, Microwave Junctions, Ferrite Devices' },
          { num: 3, title: 'Microwave Tubes', hours: 8, topics: 'Klystron, Magnetron, TWT, BWO' },
          { num: 4, title: 'Antenna Fundamentals', hours: 8, topics: 'Antenna Parameters, Radiation Pattern, Types of Antennas' },
          { num: 5, title: 'Antenna Arrays', hours: 8, topics: 'Array Factor, Linear Arrays, Planar Arrays' }
        ],
        fixQuestions: {
          module1: [
            'Explain Smith Chart and its applications in microwave engineering.',
            'Derive the equation for single stub matching using Smith Chart.',
            'What are S-parameters? Explain their significance.',
            'Describe quarter-wave transformer for impedance matching.'
          ],
          module2: [
            'Explain the working of rectangular waveguide with modes of propagation.',
            'Describe Magic Tee and its applications with diagram.',
            'What are ferrite devices? Explain isolator and circulator.',
            'Compare TE and TM modes in waveguides.'
          ],
          module3: [
            'Explain the working principle of Reflex Klystron with applegate diagram.',
            'Describe the working of Magnetron with neat diagram.',
            'What is TWT? Explain its working principle and applications.',
            'Compare Klystron and Magnetron oscillators.'
          ],
          module4: [
            'Define and explain antenna parameters: Gain, Directivity, Beamwidth.',
            'Derive the radiation pattern of a half-wave dipole antenna.',
            'Explain Friis transmission equation with derivation.',
            'What is effective aperture of an antenna? Derive the expression.'
          ],
          module5: [
            'Derive the array factor for N-element linear array.',
            'Explain beam steering in phased array antennas.',
            'What is Yagi-Uda antenna? Explain its working and design.',
            'Describe the principle of pattern multiplication.'
          ]
        }
      },
      'BEC702': {
        name: 'Computer Networks and Protocols',
        code: 'BEC702',
        credits: 3,
        isPremium: true,
        modules: [
          { num: 1, title: 'Introduction to Networks', hours: 8, topics: 'Network Models, OSI, TCP/IP, Network Topologies' },
          { num: 2, title: 'Data Link Layer', hours: 8, topics: 'Framing, Error Control, Flow Control, MAC Protocols' },
          { num: 3, title: 'Network Layer', hours: 8, topics: 'IP Addressing, Subnetting, Routing Algorithms' },
          { num: 4, title: 'Transport Layer', hours: 8, topics: 'TCP, UDP, Congestion Control' },
          { num: 5, title: 'Application Layer', hours: 8, topics: 'HTTP, DNS, Email Protocols, Network Security' }
        ],
        fixQuestions: {
          module1: [
            'Compare OSI and TCP/IP reference models with diagram.',
            'Explain different network topologies with advantages and disadvantages.',
            'What are the functions of each layer in OSI model?',
            'Describe the principles of protocol layering.'
          ],
          module2: [
            'Explain Stop-and-Wait ARQ and Go-Back-N ARQ protocols.',
            'What is CSMA/CD? Explain its working with diagram.',
            'Describe Ethernet frame format and MAC addressing.',
            'Compare ALOHA and Slotted ALOHA protocols.'
          ],
          module3: [
            'Explain IPv4 addressing and subnetting with examples.',
            'Describe Distance Vector Routing algorithm with example.',
            'What is CIDR? Explain with subnetting example.',
            'Compare RIP and OSPF routing protocols.'
          ],
          module4: [
            'Explain TCP three-way handshake with diagram.',
            'Describe TCP congestion control mechanisms.',
            'Compare TCP and UDP protocols with use cases.',
            'What is flow control in TCP? Explain sliding window protocol.'
          ],
          module5: [
            'Explain HTTP protocol and its versions (HTTP/1.1, HTTP/2).',
            'Describe DNS hierarchy and resolution process.',
            'What is SMTP? Explain email message format.',
            'Explain SSL/TLS protocol for secure communication.'
          ]
        }
      },
      'BEE701': {
        name: 'Switchgear and Protection',
        code: 'BEE701',
        credits: 4,
        isPremium: true,
        modules: [
          { num: 1, title: 'Protective Relays', hours: 8, topics: 'Relay Classification, Operating Principles, Relay Characteristics' },
          { num: 2, title: 'Overcurrent Protection', hours: 8, topics: 'Overcurrent Relays, Time-Current Characteristics, Coordination' },
          { num: 3, title: 'Distance Protection', hours: 8, topics: 'Distance Relays, Impedance Relay, Mho Relay' },
          { num: 4, title: 'Generator and Transformer Protection', hours: 8, topics: 'Differential Protection, Buchholz Relay, REF Protection' },
          { num: 5, title: 'Circuit Breakers', hours: 8, topics: 'Arc Interruption, Types of CBs, Testing of CBs' }
        ],
        fixQuestions: {
          module1: [
            'Classify protective relays based on operating principle. Explain each.',
            'What are the desirable qualities of a protective relay?',
            'Explain the working of electromagnetic relay with diagram.',
            'Describe the relay coordination principles in power systems.'
          ],
          module2: [
            'Explain IDMT overcurrent relay characteristics with curve.',
            'Describe the coordination of overcurrent relays in radial system.',
            'What is pickup current and time multiplier setting?',
            'Design overcurrent protection for a radial feeder system.'
          ],
          module3: [
            'Explain the principle of distance protection.',
            'Draw and explain the R-X diagram for distance relay.',
            'Compare impedance, reactance, and Mho relays.',
            'What are the zones of protection in distance relay?'
          ],
          module4: [
            'Explain differential protection of transformer with diagram.',
            'Describe Buchholz relay and its working principle.',
            'What is REF protection? Explain with diagram.',
            'Explain generator protection schemes with diagram.'
          ],
          module5: [
            'Explain arc interruption theories in circuit breakers.',
            'Compare oil, air blast, SF6, and vacuum circuit breakers.',
            'What are the ratings of circuit breakers? Explain each.',
            'Describe the testing methods for circuit breakers.'
          ]
        }
      },
      'BEE702': {
        name: 'Industrial Drives and Applications',
        code: 'BEE702',
        credits: 3,
        isPremium: true,
        modules: [
          { num: 1, title: 'Fundamentals of Electric Drives', hours: 8, topics: 'Drive Components, Load Characteristics, Motor Selection' },
          { num: 2, title: 'DC Motor Drives', hours: 8, topics: 'DC Choppers, Converter Fed DC Drives, Speed Control' },
          { num: 3, title: 'Induction Motor Drives', hours: 8, topics: 'Variable Voltage Drives, V/f Control, Vector Control' },
          { num: 4, title: 'Synchronous Motor Drives', hours: 8, topics: 'PMSM, BLDC Motors, Control Strategies' },
          { num: 5, title: 'Industrial Applications', hours: 8, topics: 'Paper Mills, Textile, Steel Industry Applications' }
        ],
        fixQuestions: {
          module1: [
            'Explain the components of an electric drive system with block diagram.',
            'Describe different types of load torque characteristics.',
            'What are the factors for selection of electric motors for drives?',
            'Explain four-quadrant operation of electric drives.'
          ],
          module2: [
            'Explain DC chopper fed DC motor drive with waveforms.',
            'Describe armature voltage control of DC motor.',
            'What is regenerative braking in DC drives? Explain.',
            'Compare single-phase and three-phase converter fed DC drives.'
          ],
          module3: [
            'Explain V/f control of induction motor with diagram.',
            'Describe direct torque control of induction motor.',
            'What is vector control? Explain field-oriented control.',
            'Compare scalar control and vector control of IM drives.'
          ],
          module4: [
            'Explain the construction and working of PMSM drive.',
            'Describe BLDC motor drive with electronic commutation.',
            'What is sensorless control of PMSM? Explain methods.',
            'Compare PMSM and induction motor drives.'
          ],
          module5: [
            'Explain electric drive applications in paper mills.',
            'Describe the drive requirements in textile industry.',
            'What are the drive applications in steel rolling mills?',
            'Explain crane and hoist drive systems.'
          ]
        }
      },
      'BME701': {
        name: 'Finite Element Methods',
        code: 'BME701',
        credits: 4,
        isPremium: true,
        modules: [
          { num: 1, title: 'Introduction to FEM', hours: 8, topics: 'FEM Basics, Variational Methods, Weighted Residual Methods' },
          { num: 2, title: 'One-Dimensional Problems', hours: 8, topics: '1D Element, Shape Functions, Assembly, Boundary Conditions' },
          { num: 3, title: 'Two-Dimensional Problems', hours: 8, topics: 'CST, LST Elements, Isoparametric Formulation' },
          { num: 4, title: 'Dynamic Analysis', hours: 8, topics: 'Mass Matrix, Free Vibration, Transient Analysis' },
          { num: 5, title: 'Heat Transfer and Fluid Flow', hours: 8, topics: 'Steady State Heat Transfer, Convection, Fluid Flow' }
        ],
        fixQuestions: {
          module1: [
            'Explain the steps involved in Finite Element Analysis.',
            'Derive the stiffness matrix using variational approach.',
            'What are weighted residual methods? Explain Galerkin method.',
            'Compare Rayleigh-Ritz and Galerkin methods.'
          ],
          module2: [
            'Derive the shape functions for 1D bar element.',
            'Explain the assembly of global stiffness matrix with example.',
            'Solve a 1D bar problem using FEM for axial deformation.',
            'Describe the application of boundary conditions in FEM.'
          ],
          module3: [
            'Derive the stiffness matrix for CST element.',
            'Explain isoparametric formulation with shape functions.',
            'What is numerical integration? Explain Gauss quadrature.',
            'Solve a plane stress problem using CST element.'
          ],
          module4: [
            'Derive the consistent mass matrix for 1D element.',
            'Explain free vibration analysis using FEM.',
            'What are eigenvalue problems? Explain solution methods.',
            'Describe transient analysis using direct integration.'
          ],
          module5: [
            'Derive FEM formulation for steady-state heat conduction.',
            'Explain convection boundary condition in heat transfer.',
            'Solve a 1D heat transfer problem using FEM.',
            'Describe FEM formulation for fluid flow problems.'
          ]
        }
      },
      'BME702': {
        name: 'Hydraulics and Pneumatics',
        code: 'BME702',
        credits: 3,
        isPremium: true,
        modules: [
          { num: 1, title: 'Hydraulic Systems', hours: 8, topics: 'Hydraulic Principles, Fluid Properties, Pascal\'s Law' },
          { num: 2, title: 'Hydraulic Components', hours: 8, topics: 'Pumps, Actuators, Valves, Accumulators' },
          { num: 3, title: 'Hydraulic Circuit Design', hours: 8, topics: 'Circuit Symbols, Circuit Design, Speed Control' },
          { num: 4, title: 'Pneumatic Systems', hours: 8, topics: 'Pneumatic Principles, Air Preparation, Compressors' },
          { num: 5, title: 'Pneumatic Circuits', hours: 8, topics: 'Pneumatic Valves, Circuit Design, Electro-Pneumatics' }
        ],
        fixQuestions: {
          module1: [
            'Explain Pascal\'s law and its application in hydraulics.',
            'Describe the advantages and limitations of hydraulic systems.',
            'What are the properties of hydraulic fluids? Explain.',
            'Compare hydraulic and pneumatic systems.'
          ],
          module2: [
            'Classify hydraulic pumps and explain gear pump working.',
            'Describe the working of double-acting hydraulic cylinder.',
            'Explain directional control valves with symbols.',
            'What is an accumulator? Explain types and applications.'
          ],
          module3: [
            'Design a hydraulic circuit for a press operation.',
            'Explain meter-in and meter-out speed control circuits.',
            'Describe regenerative circuit with diagram.',
            'Design a sequence control hydraulic circuit.'
          ],
          module4: [
            'Explain the working of reciprocating air compressor.',
            'Describe FRL unit and its components.',
            'What is free air delivery? How is it calculated?',
            'Compare single-stage and multi-stage compressors.'
          ],
          module5: [
            'Design a pneumatic circuit for single-acting cylinder.',
            'Explain electro-pneumatic control with diagram.',
            'Describe time delay circuits in pneumatics.',
            'Design a sequential control pneumatic circuit.'
          ]
        }
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const branchId = params.get('branch') || 'cse';
      const sem = params.get('sem') || '3';
      const code = params.get('code') || 'BCS304';

      const branch = VTUData.getBranch(branchId);
      const subjects = VTUData.getSubjects(branchId, parseInt(sem));
      const subject = subjects.find(s => s.code === code);

      if (branch) {
        document.getElementById('branchLink').textContent = branch.name;
        document.getElementById('branchLink').href = `branch.html?branch=${branchId}`;
        document.getElementById('branchName').textContent = branch.name;
      }

      if (subject) {
        document.getElementById('subjectCode').textContent = subject.code;
        document.getElementById('subjectCodeBadge').textContent = subject.code;
        document.getElementById('subjectName').textContent = subject.name;
        document.getElementById('semNum').textContent = sem;
        document.getElementById('credits').textContent = subject.credits;
        document.title = `${subject.name} - Braintube`;

        renderNotes(subject);
        renderSyllabus(subject);
        renderPapers(subject);
        renderFixQuestions(subject);

        // Auto-navigate to Fix Questions tab if subject has fix questions
        if (subject.hasFix) {
          // Switch to Fix Questions tab
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');
          document.querySelector('.tab[data-tab="fix"]').classList.add('active');
          document.getElementById('fix-panel').style.display = 'block';
        }
      }

      // Tab switching
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-panel').forEach(p => p.style.display = 'none');
          tab.classList.add('active');
          document.getElementById(tab.dataset.tab + '-panel').style.display = 'block';
        });
      });
    });

    function renderNotes(subject) {
      const panel = document.getElementById('notes-panel');
      const modules = syllabusData[subject.code]?.modules || [
        { num: 1, title: 'Module 1' }, { num: 2, title: 'Module 2' },
        { num: 3, title: 'Module 3' }, { num: 4, title: 'Module 4' }, { num: 5, title: 'Module 5' }
      ];

      panel.innerHTML = `
        <div class="resource-list">
          ${modules.map(m => `
            <div class="resource-item">
              <div class="resource-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
              </div>
              <div class="resource-info">
                <h4 class="resource-title">Module ${m.num} - ${m.title}</h4>
                <div class="resource-meta"><span>PDF Notes</span><span>VTU 2022 Scheme</span></div>
              </div>
              <div class="resource-actions">
                <button class="btn btn-primary btn-sm" onclick="showToast('Download starting...', 'success')">Download</button>
              </div>
            </div>
          `).join('')}
          <div class="resource-item">
            <div class="resource-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            </div>
            <div class="resource-info">
              <h4 class="resource-title">Complete Notes (All Modules)</h4>
              <div class="resource-meta"><span>Full Subject Notes</span><span>Compiled PDF</span></div>
            </div>
            <div class="resource-actions">
              <button class="btn btn-primary btn-sm" onclick="showToast('Download starting...', 'success')">Download</button>
            </div>
          </div>
        </div>
      `;
    }

    function renderSyllabus(subject) {
      const panel = document.getElementById('syllabus-panel');
      // Try comprehensive syllabus first, then fallback to basic
      const data = (window.VTUSyllabus && VTUSyllabus[subject.code]) || syllabusData[subject.code];

      if (data) {
        panel.innerHTML = `
          <!-- Course Description -->
          <div class="card card-gradient" style="margin-bottom: var(--space-4);">
            <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: var(--space-3);">
              <div style="flex: 1;">
                <h3 style="margin: 0 0 var(--space-2) 0;">${data.name || subject.name}</h3>
                <div style="display: flex; gap: var(--space-4); flex-wrap: wrap; color: var(--text-secondary); font-size: var(--text-sm);">
                  <span style="display: flex; align-items: center; gap: 4px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg>
                    Code: <strong>${data.code || subject.code}</strong>
                  </span>
                  <span style="display: flex; align-items: center; gap: 4px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>
                    Credits: <strong>${data.credits || subject.credits}</strong>
                  </span>
                  <span style="display: flex; align-items: center; gap: 4px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/></svg>
                    Scheme: <strong>VTU 2022</strong>
                  </span>
                </div>
              </div>
              <div style="display: flex; gap: var(--space-2);">
                <button class="btn btn-outline btn-sm" onclick="viewSyllabus('${subject.code}')" style="display: flex; align-items: center; gap: 4px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                  View PDF
                </button>
                <button class="btn btn-primary btn-sm" onclick="downloadSyllabus('${subject.code}')" style="display: flex; align-items: center; gap: 4px;">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                  Download
                </button>
              </div>
            </div>
            ${data.description ? `<p style="color: var(--text-secondary); margin-top: var(--space-3); font-size: var(--text-sm);">${data.description}</p>` : ''}
          </div>

          <!-- Course Objectives -->
          <div class="card" style="margin-bottom: var(--space-4);">
            <h4 style="margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
              Course Objectives
            </h4>
            <ul style="color: var(--text-secondary); padding-left: var(--space-6); list-style: disc;">
              ${(data.objectives || ['Apply theoretical concepts', 'Develop problem-solving skills', 'Understand core principles']).map(obj => `<li style="margin-bottom: var(--space-2);">${obj}</li>`).join('')}
            </ul>
          </div>

          <!-- Course Outcomes -->
          ${data.outcomes ? `
          <div class="card" style="margin-bottom: var(--space-4);">
            <h4 style="margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--success-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
              Course Outcomes
            </h4>
            <ul style="color: var(--text-secondary); padding-left: var(--space-6); list-style: disc;">
              ${data.outcomes.map(out => `<li style="margin-bottom: var(--space-2);">${out}</li>`).join('')}
            </ul>
          </div>
          ` : ''}

          <!-- Module Breakdown -->
          <div class="card" style="margin-bottom: var(--space-4);">
            <h4 style="margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
              Module Breakdown
            </h4>
            <div class="resource-list">
              ${(data.modules || []).map(m => `
                <div class="resource-item" style="border: none; padding: var(--space-4); background: var(--bg-tertiary); border-radius: var(--radius-md);">
                  <div class="resource-info" style="flex: 1;">
                    <h4 class="resource-title" style="color: var(--primary); margin-bottom: var(--space-2);">
                      Module ${m.num}: ${m.title}
                    </h4>
                    <div style="display: flex; gap: var(--space-4); margin-bottom: var(--space-2); font-size: var(--text-sm); color: var(--text-secondary);">
                      <span style="display: flex; align-items: center; gap: 4px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        ${m.hours} Teaching Hours
                      </span>
                    </div>
                    <p style="font-size: var(--text-sm); color: var(--text-secondary); line-height: 1.6;">
                      <strong>Topics:</strong> ${m.topics}
                    </p>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Textbooks -->
          ${data.textbooks ? `
          <div class="card" style="margin-bottom: var(--space-4);">
            <h4 style="margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
              Textbooks
            </h4>
            <ul style="color: var(--text-secondary); font-size: var(--text-sm); padding-left: var(--space-6);">
              ${data.textbooks.map(book => `<li style="margin-bottom: var(--space-2); display: flex; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 3px;"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg> ${book}</li>`).join('')}
            </ul>
          </div>
          ` : ''}

          <!-- Reference Books -->
          ${data.references ? `
          <div class="card">
            <h4 style="margin-bottom: var(--space-4); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
              Reference Books
            </h4>
            <ul style="color: var(--text-secondary); font-size: var(--text-sm); padding-left: var(--space-6);">
              ${data.references.map(book => `<li style="margin-bottom: var(--space-2); display: flex; gap: 8px;"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0; margin-top: 3px;"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg> ${book}</li>`).join('')}
            </ul>
          </div>
          ` : `
          <div class="card">
            <h4 style="margin-bottom: var(--space-3); display: flex; align-items: center; gap: var(--space-2);">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--primary-400)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              Reference Books
            </h4>
            <ul style="color: var(--text-secondary); font-size: var(--text-sm);">
              <li style="margin-bottom: var(--space-2);">â¢ Textbook as per VTU syllabus</li>
              <li style="margin-bottom: var(--space-2);">â¢ Reference books recommended by faculty</li>
            </ul>
          </div>
          `}
        `;
      } else {
        panel.innerHTML = `
          <div class="card" style="text-align: center; padding: var(--space-8);">
            <div style="margin-bottom: var(--space-4); color: var(--primary-400);">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto;"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/></svg>
            </div>
            <h4>VTU 2022 Scheme Syllabus</h4>
            <p style="color: var(--text-secondary); margin-top: var(--space-2);">Syllabus for ${subject.name} (${subject.code})</p>
            <div style="display: flex; gap: var(--space-3); justify-content: center; margin-top: var(--space-4); flex-wrap: wrap;">
              <button class="btn btn-outline" onclick="viewSyllabus('${subject.code}')" style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                View Syllabus
              </button>
              <button class="btn btn-primary" onclick="downloadSyllabus('${subject.code}')" style="display: flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                Download PDF
              </button>
            </div>
          </div>
        `;
      }
    }

    // View syllabus in new tab
    function viewSyllabus(code) {
      showToast('Opening syllabus viewer...', 'info');
      // Will open PDF viewer when files are uploaded
      setTimeout(() => showToast('Syllabus PDF ready for viewing', 'success'), 500);
    }

    // Download syllabus PDF
    function downloadSyllabus(code) {
      showToast('Preparing syllabus download...', 'info');
      // Will trigger download when files are uploaded
      setTimeout(() => showToast('Syllabus PDF download started', 'success'), 500);
    }

    function renderPapers(subject) {
      const panel = document.getElementById('papers-panel');
      const years = ['Dec/Jan 2025-26', 'June/July 2025', 'Dec/Jan 2024-25', 'June/July 2024', 'Dec/Jan 2023-24'];

      panel.innerHTML = `
        <div class="resource-list">
          ${years.map((year, i) => `
            <div class="resource-item">
              <div class="resource-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>
              </div>
              <div class="resource-info">
                <h4 class="resource-title">${year} Question Paper</h4>
                <div class="resource-meta"><span>VTU Exam</span><span>${i < 2 ? 'With Solutions' : 'Paper Only'}</span></div>
              </div>
              <div class="resource-actions">
                <button class="btn btn-primary btn-sm" onclick="showToast('Downloading...', 'success')">Download</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderFixQuestions(subject) {
      const panel = document.getElementById('fix-panel');
      const data = syllabusData[subject.code];

      // Show premium payment for ALL subjects with hasFix: true
      if (subject.hasFix) {
        // Premium fix questions - locked with payment form
        const modules = data?.modules || [
          { num: 1, title: 'Module 1' }, { num: 2, title: 'Module 2' },
          { num: 3, title: 'Module 3' }, { num: 4, title: 'Module 4' }, { num: 5, title: 'Module 5' }
        ];
        const totalQuestions = data?.fixQuestions ? Object.values(data.fixQuestions).flat().length : 20;

        panel.innerHTML = `
          <!-- Premium Banner -->
          <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); text-align: center; padding: var(--space-10);">
            <div style="margin-bottom: var(--space-4); color: white;">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto;"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
            </div>
            <h2 style="color: white; margin-bottom: var(--space-3);">Premium Fix Questions</h2>
            <p style="color: rgba(255,255,255,0.9); margin-bottom: var(--space-6); font-size: var(--text-lg);">${subject.code} - ${subject.name}</p>
            
            <div style="display: flex; justify-content: center; gap: var(--space-8); margin-bottom: var(--space-6); flex-wrap: wrap;">
              <div style="text-align: center;">
                <div style="font-size: 2.5rem; font-weight: 700; color: white;">${totalQuestions}</div>
                <div style="font-size: var(--text-sm); color: rgba(255,255,255,0.8);">Questions</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 2.5rem; font-weight: 700; color: white;">80%+</div>
                <div style="font-size: var(--text-sm); color: rgba(255,255,255,0.8);">Exam Accuracy</div>
              </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.15); border-radius: var(--radius-xl); padding: var(--space-6); margin-bottom: var(--space-6); max-width: 300px; margin-left: auto; margin-right: auto;">
              <div style="font-size: var(--text-sm); color: rgba(255,255,255,0.7); text-decoration: line-through;">â¹149</div>
              <div style="font-size: var(--text-3xl); font-weight: 800; color: white;">â¹79</div>
            </div>
            
            <button class="btn" id="buy-now-btn" style="background: white; color: #764ba2; font-weight: 700; padding: var(--space-4) var(--space-10); font-size: var(--text-lg); border-radius: var(--radius-lg); display: flex; align-items: center; gap: 8px; margin: 0 auto;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
              Buy Now - â¹79
            </button>
            
            <div style="margin-top: var(--space-6); display: flex; justify-content: center; gap: var(--space-6); flex-wrap: wrap;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Secure Payment
              </div>
            </div>
          </div>
        `;

        // Add click event for buy button - store data in variables to avoid escaping issues
        const buyBtn = document.getElementById('buy-now-btn');
        const subCode = subject.code;
        const subName = subject.name;
        buyBtn.addEventListener('click', function () {
          showPaymentForm(subCode, subName, 79);
        });
      } else {
        // Fix Questions not available for this subject
        panel.innerHTML = `
          <div class="card card-gradient" style="text-align: center; padding: var(--space-10);">
            <div style="margin-bottom: var(--space-4); color: var(--primary-400);">
              <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto;"><path d="M4 19.5V4a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v15.5a2.5 2.5 0 0 0 2.5 2.5c.34 0 .68-.03 1-.1"/><path d="M6 2h10"/><path d="M12 2v20"/><path d="M6 14h12"/><path d="M18 11V6a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v15a2.5 2.5 0 0 1 2.5-2.5H18"/></svg>
            </div>
            <h3 style="margin-bottom: var(--space-3);">Fix Questions Coming Soon</h3>
            <p style="color: var(--text-secondary); margin-bottom: var(--space-4);">
              Fix Questions for ${subject.code} - ${subject.name} are currently being prepared.
            </p>
            <p style="color: var(--text-muted); font-size: var(--text-sm);">
              Check back soon or explore other resources.
            </p>
          </div>
        `;
      }
    }

    // Store user info for payment
    let paymentUserInfo = {};

    // Show payment form before Razorpay
    function showPaymentForm(subjectCode, subjectName, amount) {
      const modal = document.createElement('div');
      modal.id = 'payment-form-modal';
      modal.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: var(--space-4);">
          <div style="background: var(--bg-primary); border-radius: var(--radius-xl); padding: var(--space-8); max-width: 450px; width: 100%;">
            <div style="text-align: center; margin-bottom: var(--space-6);">
              <div style="margin-bottom: var(--space-3); color: var(--primary-400);">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto;"><path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/><path d="m15 5 4 4"/></svg>
              </div>
              <h3 style="margin-bottom: var(--space-2);">Complete Your Purchase</h3>
              <p style="color: var(--text-secondary); font-size: var(--text-sm);">Fix Questions for ${subjectCode}</p>
            </div>
            
            <form id="payment-info-form" style="display: flex; flex-direction: column; gap: var(--space-4);">
              <div>
                <label style="display: block; margin-bottom: var(--space-2); font-weight: 500; color: var(--text-primary);">Full Name *</label>
                <input type="text" id="payment-name" required placeholder="Enter your full name" 
                  style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-size: var(--text-base);">
              </div>
              
              <div>
                <label style="display: block; margin-bottom: var(--space-2); font-weight: 500; color: var(--text-primary);">Gmail Address *</label>
                <input type="email" id="payment-email" required placeholder="yourname@gmail.com" 
                  style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-secondary); color: var(--text-primary); font-size: var(--text-base);">
              </div>
              
              <div>
                <label style="display: block; margin-bottom: var(--space-2); font-weight: 500; color: var(--text-primary);">Subject Code</label>
                <input type="text" id="payment-subject" value="${subjectCode}" readonly 
                  style="width: 100%; padding: var(--space-3); border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-tertiary); color: var(--text-muted); font-size: var(--text-base);">
              </div>
              
              <div style="background: var(--bg-secondary); padding: var(--space-4); border-radius: var(--radius-md); text-align: center;">
                <div style="font-size: var(--text-sm); color: var(--text-muted);">Amount to Pay</div>
                <div style="font-size: var(--text-2xl); font-weight: 700; color: var(--primary);">â¹${amount}</div>
              </div>
              
              <button type="submit" class="btn btn-primary" style="width: 100%; padding: var(--space-4); font-size: var(--text-lg);">
                ð³ Proceed to Payment
              </button>
              
              <button type="button" onclick="closePaymentForm()" style="width: 100%; padding: var(--space-3); background: transparent; border: 1px solid var(--border-color); border-radius: var(--radius-md); color: var(--text-secondary); cursor: pointer;">
                Cancel
              </button>
            </form>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Handle form submission
      document.getElementById('payment-info-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const name = document.getElementById('payment-name').value.trim();
        const email = document.getElementById('payment-email').value.trim();

        if (!name || !email) {
          showToast('Please fill all fields', 'error');
          return;
        }

        // Store user info
        paymentUserInfo = { name, email, subjectCode, subjectName };

        // Disable button and show loading state
        const submitBtn = e.target.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="loader-spinner"></span> Initializing...';

        // Final backend wake-up check
        if (typeof pingBackend === 'function') pingBackend();

        handlePayment(subjectCode, subjectName, amount, name, email).finally(() => {
          // Close form only if handlePayment is done (rzp.open() is synchronous but create-order isn't)
          // We close it inside handlePayment usually, but it's safe here too
        });
      });
    }

    // Close payment form
    function closePaymentForm() {
      const modal = document.getElementById('payment-form-modal');
      if (modal) modal.remove();
    }

    // Payment handler function with Razorpay
    async function handlePayment(subjectCode, subjectName, amount, userName, userEmail) {
      try {
        showToast('Initiating secure payment...', 'success');

        // Step 1: Create Order on the Server
        const orderResponse = await fetch(getApiUrl('/api/payments/create-order'), {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            planId: 'fix_questions',
            email: userEmail,
            subjectCode: subjectCode,
            subjectName: subjectName,
            name: userName
          })
        });

        const orderData = await orderResponse.json();

        if (!orderData.success) {
          throw new Error(orderData.error || 'Failed to create order');
        }

        const options = {
          key: orderData.key, // Use key from server (dynamic)
          amount: orderData.order.amount,
          currency: orderData.order.currency,
          name: 'Braintube',
          description: `Fix Questions - ${subjectCode}`,
          order_id: orderData.order.id, // CRITICAL: Use Order ID for auto-capture
          image: 'https://braintube.site/assets/logo.png',
          handler: function (response) {
            handlePaymentSuccess(response, subjectCode, subjectName, amount, userName, userEmail);
          },
          prefill: {
            name: userName || '',
            email: userEmail || '',
            contact: ''
          },
          notes: {
            subject_code: subjectCode,
            subject_name: subjectName,
            customer_name: userName,
            customer_email: userEmail,
            product: 'Fix Questions'
          },
          theme: {
            color: '#764ba2'
          },
          modal: {
            ondismiss: function () {
              showToast('Payment cancelled', 'error');
            }
          }
        };

        const rzp = new Razorpay(options);
        rzp.on('payment.failed', function (response) {
          handlePaymentFailure(response);
        });

        // Close the temporary form modal before opening the official Razorpay popup
        closePaymentForm();

        rzp.open();

      } catch (error) {
        console.error('Razorpay process error:', error);
        showToast(`Payment failed: ${error.message}`, 'error');
      }
    }

    // Handle successful payment - Show Thank You page
    async function handlePaymentSuccess(response, subjectCode, subjectName, amount, userName, userEmail) {
      console.log('Payment successful:', response);

      try {
        showToast('Verifying payment...', 'success');

        // Step 1: Verify Payment on the Server
        const verifyResponse = await fetch(getApiUrl('/api/payments/verify'), {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            razorpay_order_id: response.razorpay_order_id,
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_signature: response.razorpay_signature
          })
        });

        const verifyData = await verifyResponse.json();

        if (!verifyData.success) {
          throw new Error(verifyData.error || 'Payment verification failed');
        }

        // Store payment info
        const purchasedItems = JSON.parse(localStorage.getItem('braintube_purchases') || '[]');
        purchasedItems.push({
          subjectCode,
          subjectName,
          amount,
          userName,
          userEmail,
          paymentId: response.razorpay_payment_id,
          orderId: response.razorpay_order_id,
          purchasedAt: new Date().toISOString()
        });
        localStorage.setItem('braintube_purchases', JSON.stringify(purchasedItems));

        // Submit to backend for fulfillment (already handled inside the verify route on server now)
        // However, we still call the submissions API if we want a separate record
        submitFixQuestionsForm(userName, userEmail, subjectCode, subjectName, response.razorpay_payment_id, amount);

        // Show Thank You page
        showThankYouPage(subjectCode, subjectName, response.razorpay_payment_id, userName);

      } catch (error) {
        console.error('Payment error:', error);
        showToast(`Payment verification failed: ${error.message}`, 'error');
      }
    }

    // Submit fix questions form to backend
    async function submitFixQuestionsForm(name, email, subjectCode, subjectName, paymentId, amount) {
      try {
        const response = await fetch(getApiUrl('/api/fix-questions/submit'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            name,
            email,
            subjectCode,
            subjectName,
            paymentId,
            amount
          })
        });

        const data = await response.json();
        console.log('Form submission response:', data);

        if (!data.success) {
          console.error('Form submission failed:', data.error);
        }
      } catch (error) {
        console.error('Error submitting form:', error);
      }
    }

    // Handle payment failure
    function handlePaymentFailure(response) {
      console.error('Payment failed:', response);
      showToast('Payment failed: ' + response.error.description, 'error');
    }

    // Show Thank You page after payment
    function showThankYouPage(subjectCode, subjectName, paymentId, userName) {
      const modal = document.createElement('div');
      modal.id = 'thank-you-modal';
      modal.innerHTML = `
        <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: var(--space-4);">
          <div style="background: white; border-radius: var(--radius-xl); padding: var(--space-10); max-width: 500px; width: 100%; text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <div style="font-size: 5rem; margin-bottom: var(--space-4);">ð</div>
            <h1 style="margin-bottom: var(--space-3); color: #764ba2; font-size: var(--text-3xl);">Thank You!</h1>
            <p style="color: #666; margin-bottom: var(--space-2); font-size: var(--text-lg);">
              Dear <strong>${userName || 'Student'}</strong>,
            </p>
            <p style="color: #666; margin-bottom: var(--space-6);">
              Your payment for <strong>${subjectCode} - ${subjectName}</strong> Fix Questions was successful!
            </p>
            
            <div style="background: #f8f9fa; border-radius: var(--radius-md); padding: var(--space-4); margin-bottom: var(--space-6);">
              <div style="font-size: var(--text-sm); color: #999;">Payment ID</div>
              <div style="font-family: monospace; color: #333; font-size: var(--text-sm);">${paymentId}</div>
            </div>
            
            <p style="font-size: var(--text-sm); color: #666; margin-bottom: var(--space-6);">
              We will contact you soon with your Fix Questions PDF.
            </p>
            
            <button onclick="goToFixQuestions('${subjectCode}')" class="btn" style="background: #764ba2; color: white; width: 100%; padding: var(--space-4); font-size: var(--text-lg); border: none; border-radius: var(--radius-lg); cursor: pointer;">
              â Continue
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }

    // Go to fix questions page
    function goToFixQuestions(subjectCode) {
      const modal = document.getElementById('thank-you-modal');
      if (modal) modal.remove();

      // Refresh the page to show content (or redirect)
      showToast('Thank you for your purchase!', 'success');
    }

    // Check if user has purchased this subject
    function hasPurchased(subjectCode) {
      const purchases = JSON.parse(localStorage.getItem('braintube_purchases') || '[]');
      return purchases.some(p => p.subjectCode === subjectCode);
    }
  </script>
</body>

</html>